<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visor Catastral - Briceño Antioquia</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol/ol.js"></script>
  <script src="layers/Predios_Usos_Unidos_0.js"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100vh; }
    .ol-popup {
      position: absolute;
      background-color: white;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #cccccc;
      bottom: 12px;
      left: -50px;
      min-width: 200px;
    }
    #searchBox {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: white;
      border-radius: 8px;
      padding: 5px;
      box-shadow: 0px 0px 8px rgba(0,0,0,0.3);
    }
    #title {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 8px 15px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 18px;
      color: #2c3e50;
      box-shadow: 0px 0px 6px rgba(0,0,0,0.3);
    }
  </style>
</head>

<body>
  <div id="searchBox">
    <input type="text" id="searchInput" placeholder="Buscar por matrícula (PK_PREDIOS)" />
    <button id="searchBtn">Buscar</button>
  </div>
  <div id="title">Visor Catastral - Briceño, Antioquia</div>
  <div id="map"></div>

  <script>
    // --- Mapa base ---
    const map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        })
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([-75.667, 6.666]), // Centro aproximado Briceño, Antioquia
        zoom: 13
      })
    });

    // --- Capa vectorial principal ---
    var format_Predios_Usos_Unidos_0 = new ol.format.GeoJSON();
    var features_Predios_Usos_Unidos_0 = format_Predios_Usos_Unidos_0.readFeatures(json_Predios_Usos_Unidos_0, {
      dataProjection: 'EPSG:4326',
      featureProjection: 'EPSG:3857'
    });

    var jsonSource_Predios_Usos_Unidos_0 = new ol.source.Vector();
    jsonSource_Predios_Usos_Unidos_0.addFeatures(features_Predios_Usos_Unidos_0);

    var lyr_Predios_Usos_Unidos_0 = new ol.layer.Vector({
      source: jsonSource_Predios_Usos_Unidos_0,
      style: style_Predios_Usos_Unidos_0,
      title: "Predios_Usos_Unidos",
      interactive: true
    });

    map.addLayer(lyr_Predios_Usos_Unidos_0);

    // --- Popup para mostrar atributos ---
    const popup = document.createElement('div');
    popup.className = 'ol-popup';
    const overlay = new ol.Overlay({
      element: popup,
      positioning: 'bottom-center',
      stopEvent: false
    });
    map.addOverlay(overlay);

    map.on('click', function (evt) {
      const feature = map.forEachFeatureAtPixel(evt.pixel, f => f);
      if (feature) {
        const props = feature.getProperties();
        const html = `
          <b>Matrícula:</b> ${props.PK_PREDIOS || 'N/A'}<br>
          <b>Vereda:</b> ${props.NOMBRE_VER || 'N/A'}<br>
          <b>Uso:</b> ${props.Usos || 'N/A'}
        `;
        popup.innerHTML = html;
        overlay.setPosition(evt.coordinate);
      }
    });

    // --- Buscador ---
    document.getElementById('searchBtn').addEventListener('click', function () {
      const value = document.getElementById('searchInput').value.trim();
      if (!value) return alert('Ingrese una matrícula (PK_PREDIOS).');

      const features = jsonSource_Predios_Usos_Unidos_0.getFeatures();
      const found = features.find(f => String(f.get('PK_PREDIOS')) === value);

      if (found) {
        const geom = found.getGeometry();
        const extent = geom.getExtent();
        map.getView().fit(extent, { duration: 1000, maxZoom: 17 });

        const coords = ol.extent.getCenter(extent);
        const props = found.getProperties();
        popup.innerHTML = `
          <b>Matrícula:</b> ${props.PK_PREDIOS}<br>
          <b>Vereda:</b> ${props.NOMBRE_VER}<br>
          <b>Uso:</b> ${props.Usos}
        `;
        overlay.setPosition(coords);
      } else {
        alert('No se encontró la matrícula ingresada.');
      }
    });
  </script>
</body>
</html>
