<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Explorador Rural ‚Äì Brice√±o, Antioquia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Estilos QGIS2Web -->
<link rel="stylesheet" href="css/qgis2web.css">
<link rel="stylesheet" href="css/leaflet-search.css">
<link rel="stylesheet" href="css/fontawesome-all.min.css">

<!-- Scripts QGIS2Web -->
<script src="js/qgis2web_expressions.js"></script>
<script src="js/leaflet-search.js"></script>
<script src="js/leaflet.rotatedMarker.js"></script>
<script src="js/leaflet.pattern.js"></script>
<script src="js/Autolinker.min.js"></script>
<script src="js/rbush.min.js"></script>
<script src="js/labelgun.min.js"></script>
<script src="js/labels.js"></script>

<!-- Capa de predios -->
<script src="layers/Predios_Usos_Unidos_0.js"></script>

<style>
html, body, #map {
  width: 100%;
  height: 100%;
  margin: 0;
}
.leaflet-control-search {
  border-radius: 20px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.home-button {
  background: white;
  border: 2px solid #ccc;
  border-radius: 8px;
  cursor: pointer;
  padding: 5px;
  box-shadow: 0 1px 5px rgba(0,0,0,0.4);
}
.home-button:hover {
  background: #f0f0f0;
}
</style>
</head>
<body>
<div id="map"></div>

<script>
// Crear mapa
var map = L.map('map', {
    zoomControl: true,
    maxZoom: 22,
    minZoom: 8
}).setView([7.113, -75.62], 11); // Coordenadas iniciales (ajusta si tu mapa empieza en otra zona)

// Capa base
var base = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

// Estilo de predios
function style_Predios_Usos_Unidos_0(feature) {
    return {
        color: 'black',
        weight: 0.5,
        opacity: 1,
        fillOpacity: 0.6,
        fillColor: feature.properties.UsoPrincipal === 'Agr√≠cola' ? '#8dd3c7' :
                   feature.properties.UsoPrincipal === 'Ganadero' ? '#80b1d3' :
                   feature.properties.UsoPrincipal === 'Forestal' ? '#bebada' :
                   feature.properties.UsoPrincipal === 'Conservaci√≥n' ? '#fb8072' :
                   '#b3de69'
    };
}

// A√±adir capa
var layer_Predios = L.geoJson(json_Predios_Usos_Unidos_0, {
    style: style_Predios_Usos_Unidos_0,
    onEachFeature: function (feature, layer) {
        var popup = '<b>PK_PREDIOS:</b> ' + feature.properties.PK_PREDIOS +
                    '<br><b>Uso Principal:</b> ' + feature.properties.UsoPrincipal;
        layer.bindPopup(popup);
    }
}).addTo(map);

// Guardar vista inicial
var initialView = {
    center: map.getCenter(),
    zoom: map.getZoom()
};

// Control buscador
var searchControl = new L.Control.Search({
    layer: layer_Predios,
    propertyName: 'PK_PREDIOS',
    zoom: 17,
    marker: false,
    textPlaceholder: 'Insertar matr√≠cula o PK_PREDIOS',
    moveToLocation: function(latlng, title, map) {
        map.setView(latlng, 17);
    }
});
map.addControl(searchControl);

// Resaltar predio encontrado
searchControl.on('search:locationfound', function(e) {
    e.layer.setStyle({
        color: '#ff7800',
        weight: 3
    });
    if (e.layer._popup)
        e.layer.openPopup();
});

// Bot√≥n de casita üè†
var homeButton = L.control({position: 'topleft'});
homeButton.onAdd = function(map) {
    var div = L.DomUtil.create('div', 'home-button');
    div.innerHTML = '<i class="fas fa-home"></i>';
    div.title = 'Regresar a inicio';
    div.onclick = function() {
        map.setView(initialView.center, initialView.zoom);
    };
    return div;
};
homeButton.addTo(map);
</script>
</body>
</html>
