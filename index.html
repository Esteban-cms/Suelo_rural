<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Explorador Rural ‚Äì Brice√±o, Antioquia üåø</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
    }
    #map {
      height: 100vh;
      width: 100%;
    }
    .search-container {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: 50px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      padding: 6px 12px;
      z-index: 1000;
    }
    .search-input {
      border: none;
      outline: none;
      padding: 8px 12px;
      width: 320px;
      border-radius: 30px;
      font-size: 15px;
    }
    .search-button {
      background: #4CAF50;
      border: none;
      color: white;
      border-radius: 50%;
      padding: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    .search-button:hover {
      background: #45a049;
    }
    .title {
      position: absolute;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px 20px;
      border-radius: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-weight: bold;
      font-size: 18px;
      z-index: 900;
      color: #2e7d32;
    }
    ul.autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      max-height: 200px;
      overflow-y: auto;
      z-index: 1001;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    ul.autocomplete-list li {
      padding: 8px 12px;
      cursor: pointer;
    }
    ul.autocomplete-list li:hover {
      background-color: #e8f5e9;
    }
  </style>
</head>
<body>

<div class="search-container">
  <input id="searchInput" class="search-input" type="text" placeholder="Buscar por matr√≠cula..." />
  <button id="searchButton" class="search-button">üîç</button>
  <ul id="autocomplete-list" class="autocomplete-list" style="display:none;"></ul>
</div>

<div class="title">üåø Explorador Rural ‚Äì Brice√±o, Antioquia üåø</div>
<div id="map"></div>

<script>
  // --- Inicializar mapa ---
  const map = new ol.Map({
    target: 'map',
    layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      })
    ],
    view: new ol.View({
      center: ol.proj.fromLonLat([-75.6667, 7.0833]), // Brice√±o, Antioquia
      zoom: 12
    })
  });

  // --- Capa GeoJSON ---
  const prediosLayer = new ol.layer.Vector({
    source: new ol.source.Vector({
      url: 'Predios_Usos_Unidos.geojson',
      format: new ol.format.GeoJSON()
    }),
    style: new ol.style.Style({
      stroke: new ol.style.Stroke({ color: '#333', width: 1 }),
      fill: new ol.style.Fill({ color: 'rgba(100,200,100,0.3)' })
    })
  });

  map.addLayer(prediosLayer);

  // --- Seleccionar y centrar predio ---
  function seleccionarPredio(feature) {
    const extent = feature.getGeometry().getExtent();
    map.getView().fit(extent, { duration: 1000, padding: [100, 100, 100, 100] });

    const matricula = feature.get("PK_PREDIOS") || "No definida";
    const vereda = feature.get("NOMBRE_VER") || "No definida";
    const uso = feature.get("Usos") || "No definido";

    alert(`üìã Informaci√≥n del predio:\n\nMatr√≠cula: ${matricula}\nVereda: ${vereda}\nUso: ${uso}`);
  }

  // --- Buscar por matr√≠cula ---
  function buscarPredio() {
    const texto = document.getElementById('searchInput').value.trim();
    if (!texto) return;
    const feats = prediosLayer.getSource().getFeatures();
    const f = feats.find(ft => ft.get("PK_PREDIOS")?.toString() === texto);
    if (f) seleccionarPredio(f);
    else alert("No se encontr√≥ ning√∫n predio con esa matr√≠cula.");
  }

  // --- Autocompletar ---
  const searchInput = document.getElementById('searchInput');
  const autocompleteList = document.getElementById('autocomplete-list');

  searchInput.addEventListener('input', () => {
    const texto = searchInput.value.trim().toLowerCase();
    autocompleteList.innerHTML = '';
    if (!texto) {
      autocompleteList.style.display = 'none';
      return;
    }
    const feats = prediosLayer.getSource().getFeatures();
    const sugerencias = feats
      .map(ft => ft.get("PK_PREDIOS")?.toString())
      .filter(id => id && id.toLowerCase().includes(texto))
      .slice(0, 10);

    if (sugerencias.length > 0) {
      sugerencias.forEach(s => {
        const li = document.createElement('li');
        li.textContent = s;
        li.onclick = () => {
          searchInput.value = s;
          autocompleteList.style.display = 'none';
          buscarPredio();
        };
        autocompleteList.appendChild(li);
      });
      autocompleteList.style.display = 'block';
    } else {
      autocompleteList.style.display = 'none';
    }
  });

  document.getElementById('searchButton').addEventListener('click', buscarPredio);
  searchInput.addEventListener('keypress', e => { if (e.key === 'Enter') buscarPredio(); });
</script>

</body>
</html>
